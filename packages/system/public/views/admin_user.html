<section data-ng-controller="UsersAdminController" class="sectionLivre">
    <div class='col-md-6'>
        <div class="row">
            <form role="form" class="form-horizontal col-md-12" name='formulaire'>
            <h3 class='divGrisClair'>Page de l'utilisateur : {{user.name}}</h3>
                <div class='col-md-8'>
                	<input type='text' ng-model='refMedia' placeholder='CodeBarre ou ref' ng-focus class='form-control' required  ng-change="verifInput()">
                </div>
                <div class='col-md-4'>
                    <button ng-if='!newmedia.emprunt.user' type='submit' ng-click='validerEmprunt()' class="btn btn-primary btn-sm col-md-8"> Valider</button> 
                    <button ng-if='newmedia.emprunt.user === user._id' type='submit' ng-click='rendreLivre(newmedia)' class="btn btn-primary btn-sm"><i class="icon-white icon-book"></i> Rendre</button>
                </div>
            </form>
        </div> 
        <div class='row'>
              <!-- liste des emprunts de l'utilisateurs  -->
            <article class="col-md-12">
                <h4 class='lato-font-title' > Emprunts actuels :</h4>
                <ul style="list-style-type:none; margin:0; padding:0;">
                    <li class="user_list" ng-repeat="media in listeEmprunt">
                        <div class='divGrisClair'>
                           <h3>{{media.auteur}}<small><br><a data-ng-href="#!/livres/{{media._id}}">{{media.title}}</a></small></h3>
                            <div data-ng-hide="!media.lien_image">
                                <a data-ng-href="#!/livres/{{media._id}}">
                                    <img ng-src="{{media.lien_image}}" border="0" align="center" width=80 height=130>
                                 </a>
                            </div>
                            <div> Genre: {{media.dewey}} &nbsp Ref. {{media.ref}}</div>
                            <p ng-show="media.emprunt.date_fin" ng-class='{"lato-font-retard": date_diff(media).retard}' ng-bind='date_diff(media).message'> </p>   
                        </div> 
                    </li>
                </ul>
                <p ng-show='listeEmprunt.length === 0'>
                    Aucun emprunt en cours
                </p>
            </article>
        </div>
    </div> 
    <div class="col-md-5 col-md-offset-1">
        <br/>
        <div class='row'>
            <div class='col-md-12'>
                <div ng-show=' newmedia.emprunt.user &&newmedia.emprunt.user !== user._id' class='alert alert-danger trans_message' role='alert'>
                    <img src="/system/assets/img/error_ico.png" height=30px width=30px alt="Error" />  Livre déjà emprunté jusqu'au {{newmedia.emprunt.date_fin | date: 'dd/MM/yyyy'}}
                </div>
                <div ng-show=' newmedia.emprunt.user &&newmedia.emprunt.user === user._id' class='alert alert-info'  role="alert">
                   Vous avez jusqu'au {{newmedia.emprunt.date_fin | date: 'dd/MM/yyyy'}} pour rendre cet emprunt
                </div>
                <!-- Message de validation  -->
                <article>
                    <div ng-show='message_info' class='alert alert-info trans_message' role="alert">
                            {{message_info}}
                    </div>
                </article>
            </div>
        </div>
        <div class='row'>
            <div class='col-md-12'>
                <accordion close-others="oneAtATime">
                    <accordion-group heading="Abonnement de l'utilisateur" is-open="isOpen">
                        <accordion-heading >
                          Abonnement de l'utilisateur
                            <i class="pull-right glyphicon"
                                    ng-class="{'glyphicon-chevron-down': isOpen, 'glyphicon-chevron-right': !isOpen}"></i>
                          </accordion-heading>

                        <table class="table table-striped table-bordered table-hover">
                        <tr>
                        <th> abonnement </th>
                        <th>  Date_fin </th>
                        <th>  Caution </th>
                        <th>  Paiement </th>
                        </tr>
                        <tr ng-repeat="abo in user.abonnement">
                            <td>
                                  {{abo.nom}}
                            </td> 
                            <td>
                               {{abo.date_fin | date: 'dd/MM/yyyy'}} 
                            </td>
                            <td>
                                <!-- <span class="glyphicon glyphicon-remove" style='color:red'></span> -->
                                <button type="button" ng-click="aboCaution(abo)" class="btn btn-xs">
                                <span ng-class="{'glyphicon':true, 'glyphicon-ok':abo.caution, 'glyphicon-remove':!abo.caution, 'green':abo.caution, 'red':!abo.caution}"></span>
                                </button>
                            </td>
                            <td>
                                <!-- <span class="glyphicon glyphicon-ok" style='color:green'></span> -->
                                <button type="button" ng-click="aboPaiement(abo)" class="btn btn-xs">
                                <span ng-class="{'glyphicon':true, 'glyphicon-ok':abo.paiement, 'glyphicon-remove':!abo.paiement, 'green':abo.paiement, 'red':!abo.paiement}"></span>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <select class='form-control' ng-model='newAbo' ng-options="aboption.name for aboption in option_abo">
                                    <!-- <option value=''> Nouveau </option> -->
                                </select>
                            </td>
                            <td style='text-align:center' colspan="2">
                                 <button ng-click='validerNewAbo(newAbo)' class="btn btn-primary btn-md"> Valider</button> 
                            </td>
                        </tr>
                        </table>
                    </accordion-group>
                </accordion>
            </div>
        </div>
        <div class='row'>
            <div class='col-md-12'>
                <article>
                    <h4 class='lato-font-title'> Dernières modifications : </h4>
                    <div ng-class="{'divGrisClair' : listeModif.length}">
                        <ul style="list-style-type:none; margin:0; padding:0;">
                            <li class="user_list" ng-repeat="media in listeModif">
                             <a ng-class='{"lato-font-retard" : media.type == "old"}' data-ng-href="#!/livres/{{media._id}}">{{media.title}}</a>
                            </li>
                         </ul>
                    </div>
                </article>

                <article>
                    <h4 class='lato-font-title'> aperçu du dernier média : </h4>
                    <div ng-class="{'divGrisClair' : derniermedia}">
                        <div class="row">
                            <div style='padding-left:20px;'>
                           <h3>
                                <div ng-show="derniermedia"> {{derniermedia.auteur}}<small><br><a data-ng-href="#!/livres/{{derniermedia._id}}">{{derniermedia.title}}</a></small>
                            </h3>
                            <div data-ng-hide="!derniermedia.lien_image"><a data-ng-href="#!/livres/{{derniermedia._id}}"><img ng-src="{{derniermedia.lien_image}}" border="0" align="center" width=80 height=130> </a></div>
                            <div ng-show="derniermedia">  Genre:{{derniermedia.dewey}} &nbsp Ref. {{derniermedia.ref}} </div>
                            </div>
                        </div>
                    </div>
                </article>
            </div>
        </div>
    </div>       
</section>

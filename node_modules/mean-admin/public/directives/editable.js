angular.module('mean').directive('ngEnter', function() {
    return function(scope, elm, attrs) {
        elm.bind('keypress', function(e) {
            if (e.charCode === 13 && !e.ctrlKey) scope.$apply(attrs.ngEnter);
        });
    };
});

angular.module('mean').directive('ngEditable', function() {
    return {
        // can be in-lined or async loaded by xhr
        // or inlined as JS string (using template property)
        template: '<div class="editable-wrapper">' + '<div style="min-height:22px"data-ng-hide="edit" data-ng-click="edit=true;value=model;">{{model}}</div>' + '<input type="text" data-ng-model="value" data-ng-blur="edit = false; model = value" data-ng-show="edit" data-ng-enter="model=value;edit=false;"/>' + '</div>',
        scope: {
            model: '=ngEditableModel',
            update: '&ngEditable'
        },
        replace: true,
        link: function(scope, element, attrs) {
            // scope.$watch('model', function() {
            //     console.log('hhhhh');
            // });
            scope.focus = function() {
                console.log(element.find("input"));
                element.find("input").focus();
            };

            scope.$watch('edit', function(isEditable) {
                if (isEditable === false) {
                    scope.update();
                } else {
                    // scope.focus();
                }
            });
        }
    };
});

angular.module('mean').directive('ngEditableParagraph', function() {
    return {
        // can be in-lined or async loaded by xhr
        // or inlined as JS string (using template property)
        template: '<span class="editable-wrapper">' + '<span data-ng-hide="edit" data-ng-click="edit=true;value=model;" class="respect-newline">{{model}}</span>' + '<textarea data-ng-model="value" data-ng-blur="model=value ; edit=false" data-ng-show="edit" data-ng-enter="model=value;edit=false;" class="span8"></textarea>' + '</span>',
        scope: {
            model: '=ngEditableModel',
            update: '&ngEditableParagraph'
        },
        replace: true,
        link: function(scope, element, attrs) {
            scope.focus = function() {
                element.find("input").focus();
            };
            scope.$watch('edit', function(isEditable) {
                if (isEditable === false) {
                    scope.update();
                } else {
                    scope.focus();
                }
            });
        }
    };
});

angular.module('mean').directive('ngEditableSelect', function() {
    return {
        template: '<span class="editable-wrapper">' + '<span data-ng-hide="edit" data-ng-click="edit=true;value=model;"><span data-ng-repeat="m in model">{{m}};</span></span>' + '<select data-ng-model="value" data-ng-show="edit" data-ng-multiple="true" multiple data-ng-options="option for option in options" data-ng-change="model=value;edit=false;">' + '<option value="">Choose Option</option>' + '</select>' + '</span>',
        scope: {
            text: '&ngEditableSelectText',
            model: '=ngEditableSelectModel',
            options: '=ngEditableSelectOptions',
            update: '&ngEditableSelect'
        },
        transclude: true,
        replace: true,
        link: function(scope, element, attrs) {
            scope.$watch('edit', function(isEditable) {
                if (isEditable === false) {
                    scope.update();
                }
            });
        }
    };
});

angular.module('mean').directive('ezDatepicker', function() {
    return {
        restrict: 'A',
        link: function(scope, element, attrs) {
            var today = new Date();
            if(scope.$eval(attrs.ezDatepicker) === 'CD' || scope.$eval(attrs.ezDatepicker) == 'DVD' || scope.$eval(attrs.ezDatepicker) ==='livre_mag_revue')
                today.setFullYear(today.getFullYear()+1)
            element.datetimepicker({
             lang:'fr',
             i18n:{
              fr:{
               months:[
                'Janvier','Fevrier','Mars','Avril',
                'Mai','Juin','Juillet','Aout',
                'Septembre','Octobre','Novembre','Decembre',
               ],
               dayOfWeek:[
                "Dim.", "Lun", "Mar", "Mer", 
                "Jeu", "Ven", "Sam",
               ]
              }
             },
             timepicker:false,
             scrollInput : false,
             lazyInit : true,
             format:'Y-m-d',
             defaultDate: today
            });
        }
    };
});

angular.module('mean').filter('slice', function() {
  return function(arr, start, end) {
    return (arr || []).slice(start, end);
  };
});

angular.module('mean').filter('roundSup', function() {
  return function(number) {
    return Math.ceil(number);
  };
});
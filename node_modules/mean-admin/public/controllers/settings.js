'use strict';

angular.module('mean').controller('SettingsController', ['$scope', 'Global', 'Livres', '$rootScope', '$http',
	function($scope, Global, Livres, $rootScope, $http) {

		Livres.getSettings(function(settings) {
			$scope.settings = settings.settings;
			if (!$scope.settings.liste_genre_livre) {
				console.log('Init Liste genre Livre');
				$scope.settings.liste_genre_livre = [];
			}
		});

		$scope.validerModif = function() {
			if ($scope.add_genre_livre) {
				$scope.ajouter_genre('Livres', $scope.add_genre_livre);
			}
			$http.put('/livres/Settings', $scope.settings).success(function(response) {
				console.log('response');
				console.log(response);
			});
		};

		$scope.pop_genre = function(type, genre) {
			switch (type) {
				case "Livres":
					if ($scope.settings.liste_genre_livre.indexOf(genre) === -1) return -1;
					$scope.settings.liste_genre_livre.splice($scope.settings.liste_genre_livre.indexOf(genre), 1);
					$scope.validerModif();
					break;
				case "BD":
					break;
			}
		}

		$scope.ajouter_genre = function(type, genre) {
			switch (type) {
				case "Livres":
					if (!genre || genre.length === 0) return -1;
					$scope.settings.liste_genre_livre.push(genre);
					$scope.add_genre_livre = null;
					break;
				case "BD":
					break;
			}
			$scope.validerModif();
		}



	}
]);
'use strict';

angular.module('mean').controller('SettingsController', ['$scope', 'Global', 'Livres', '$rootScope', '$http',
	function($scope, Global, Livres, $rootScope, $http) {

		Livres.getSettings(function(settings) {
			$scope.settings = settings.settings;
			console.log($scope.settings);
			if (!$scope.settings.liste_genre_livre || $scope.settings.liste_genre_livre.length === 0) {
				console.log('Init Liste genre Livre');
				$scope.settings.liste_genre_livre = ['Science-fiction', 'Policier', 'Romans français', 'Romans anglais', 'Romans allemands', 'Romans italiens', 'Romans espagnols', 'Romans, divers', 'Documentaire'];
			}
			if (!$scope.settings.liste_genre_bd || $scope.settings.liste_genre_bd.length === 0) {
				$scope.settings.liste_genre_bd = ['Aventure', 'Erotique', 'Humour', 'Fantastique', 'Bibliographie', 'Manga', 'Enfants', 'Divers'];
			}
			if (!$scope.settings.liste_genre_cd || $scope.settings.liste_genre_cd.length === 0) {
				$scope.settings.liste_genre_cd = ['Jazz', 'Etranger', 'Français', 'Enfants', 'Classique', 'BO film', 'Blues'];
			}
			if (!$scope.settings.liste_genre_dvd || $scope.settings.liste_genre_dvd.length === 0) {
				$scope.settings.liste_genre_dvd = ['Animation', 'Aventure/Action', 'Comédie', 'Comédie dramatique', 'Documentaire', 'Fantastique/Horreur', 'Historique/Guerre', 'Musical', 'Policier/Suspense', 'Science Fiction', 'Théatre', 'Western'];
			}

		});

		$scope.validerModif = function() {
			if ($scope.add_genre_livre) {
				$scope.ajouter_genre('Livres', $scope.add_genre_livre);
			}
			if ($scope.add_genre_bd) {
				$scope.ajouter_genre('Livres', $scope.add_genre_livre);
			}
			if ($scope.add_genre_cd) {
				$scope.ajouter_genre('Livres', $scope.add_genre_livre);
			}
			if ($scope.add_genre_dvd) {
				$scope.ajouter_genre('Livres', $scope.add_genre_livre);
			}
			$http.put('/livres/Settings', $scope.settings).success(function(response) {
				console.log('response');
				console.log(response);
			});
		};

		$scope.pop_genre = function(type, genre) {
			switch (type) {
				case "Livres":
					if ($scope.settings.liste_genre_livre.indexOf(genre) === -1) return -1;	
					$scope.settings.liste_genre_livre.splice($scope.settings.liste_genre_livre.indexOf(genre), 1);
					$scope.validerModif();
					break;
				case "BD":
					if ($scope.settings.liste_genre_bd.indexOf(genre) === -1) return -1;	
					$scope.settings.liste_genre_bd.splice($scope.settings.liste_genre_bd.indexOf(genre), 1);
					$scope.validerModif();
					break;
				case "CD":
					if ($scope.settings.liste_genre_cd.indexOf(genre) === -1) return -1;	
					$scope.settings.liste_genre_cd.splice($scope.settings.liste_genre_cd.indexOf(genre), 1);
					$scope.validerModif();
					break;
				case "DVD":
					if ($scope.settings.liste_genre_dvd.indexOf(genre) === -1) return -1;	
					$scope.settings.liste_genre_dvd.splice($scope.settings.liste_genre_dvd.indexOf(genre), 1);
					$scope.validerModif();
					break;
			}
		}

		$scope.ajouter_genre = function(type, genre) {
			if (!genre || genre.length === 0) return -1;
			switch (type) {
				case "Livres":
					$scope.settings.liste_genre_livre.push(genre);
					$scope.add_genre_livre = null;
					break;
				case "BD":
					$scope.settings.liste_genre_bd.push(genre);
					$scope.add_genre_bd = null;
				case "CD":
					$scope.settings.liste_genre_cd.push(genre);
					$scope.add_genre_cd = null;
				case "DVD":
					$scope.settings.liste_genre_dvd.push(genre);
					$scope.add_genre_dvd = null;
					break;
			}
			$scope.validerModif();
		}



	}
]);
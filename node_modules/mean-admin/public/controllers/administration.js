'use strict';

angular.module('mean').controller('AdministrationController', ['$scope', 'Global', 'Menus', '$rootScope', '$http', 'Users',
  function($scope, Global, Menus, $rootScope, $http, Users) {
    $scope.global = Global;

    $scope.init = function() {
     	console.log('init');
        $scope.retards();

    };

    function date_diff(emprunt){
      var today = new Date();
      var fin = new Date(emprunt.date_fin);
      var diff = fin.getTime()- today.getTime();
      diff = Math.floor(diff / (1000 * 60 * 60 * 24));
      return diff*-1;
    };

    function getMaxRetard(user){
      var max = 0;
      for(var i in user.emprunt){
        if(date_diff(user.emprunt[i]) > max){
          max = date_diff(user.emprunt[i]);
        }
      }
      return max;
    };

    $scope.retards= function(){
      $scope.users_retards_1_week = [];
      $scope.users_retards_middle = [];
      $scope.users_retards_max = [];
    	Users.retard_moins_semaine({
    		}, function(users){
          console.log(users);
          var nbjours;
          users.forEach(function(user){
            nbjours = getMaxRetard(user);
            if(nbjours < 8){
              $scope.users_retards_1_week.push(user);
            }else if(nbjours > 15){
              $scope.users_retards_max.push(user);
            }else if(nbjours >=8 && nbjours <= 15){
              $scope.users_retards_middle.push(user);
            }
          });
    		});
    };
  }
]);